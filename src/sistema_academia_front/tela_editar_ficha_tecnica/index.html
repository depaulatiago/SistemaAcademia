<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Ficha Técnica</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <h1>Editar Ficha Técnica</h1>
    </header>

    <main>
        <button id="back-button" onclick="window.history.back()">&larr; Voltar</button>

        <form id="edit-ficha-tecnica-form">
            <div class="grid-container">
                <div class="column">
                    <label for="ficha-id">ID da Ficha:</label>
                    <input type="text" id="ficha-id" name="ficha-id" required>

                    <label for="id-aluno">ID do Aluno:</label>
                    <input type="text" id="id-aluno" name="id-aluno" required>

                    <label for="id-instrutor">ID do Instrutor:</label>
                    <input type="text" id="id-instrutor" name="id-instrutor" required>

                    <label for="ids-maquinas">IDs das Máquinas (separados por vírgula):</label>
                    <input type="text" id="ids-maquinas" name="ids-maquinas" required>
                </div>
            </div>

            <button type="submit">Salvar Alterações</button>
        </form>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("edit-ficha-tecnica-form");

            form.addEventListener("submit", async function (event) {
                event.preventDefault();

                // Captura os valores do formulário
                const fichaId = document.getElementById("ficha-id").value;
                const idAluno = document.getElementById("id-aluno").value;
                const idInstrutor = document.getElementById("id-instrutor").value;
                const idsMaquinas = document.getElementById("ids-maquinas").value
                    .split(",") // Divide os IDs por vírgula
                    .map(id => id.trim()) // Remove espaços extras
                    .map(Number); // Converte os valores para números

                const updatedFicha = {
                    idAluno: idAluno,
                    idInstrutor: idInstrutor,
                    idsMaquinas: idsMaquinas
                };

                try {
                    // Envia os dados para a API para edição
                    const response = await fetch(`http://localhost:8080/ficha/${fichaId}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(updatedFicha)
                    });

                    if (response.ok) {
                        alert("Ficha Técnica atualizada com sucesso!");
                    } else {
                        const errorMessage = await response.text();
                        alert(`Erro ao atualizar a ficha técnica: ${errorMessage}`);
                    }
                } catch (error) {
                    console.error("Erro ao atualizar ficha técnica:", error);
                    alert("Erro ao conectar-se à API.");
                }
            });
        });
    </script>
</body>

</html>
